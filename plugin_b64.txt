IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFlvdXJlV2F0Y2hpbmcgUGx1Z2luIGZvciBFbmlnbWEyCiMgQ29tcGF0aWJsZSB3aXRoIFB5dGhvbiAzLjEzCiMgU2hvd3MgIllvdSdyZSB3YXRjaGluZy4uLiIgb3ZlcmxheSB3aXRoCiMgbW92aWUgcG9zdGVyIGFuZCB0aXRsZSBvbiBjaGFubmVsIGNoYW5nZQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmcm9tIFBsdWdpbnMuUGx1Z2luIGltcG9ydCBQbHVnaW5EZXNjcmlwdG9yCmZyb20gU2NyZWVucy5TY3JlZW4gaW1wb3J0IFNjcmVlbgpmcm9tIENvbXBvbmVudHMuTGFiZWwgaW1wb3J0IExhYmVsCmZyb20gQ29tcG9uZW50cy5QaXhtYXAgaW1wb3J0IFBpeG1hcApmcm9tIENvbXBvbmVudHMuQWN0aW9uTWFwIGltcG9ydCBBY3Rpb25NYXAKZnJvbSBDb21wb25lbnRzLkNvbmZpZ0xpc3QgaW1wb3J0IENvbmZpZ0xpc3QsIENvbmZpZ0xpc3RTY3JlZW4KZnJvbSBDb21wb25lbnRzLmNvbmZpZyBpbXBvcnQgKAogICAgY29uZmlnLCBDb25maWdTdWJzZWN0aW9uLCBDb25maWdJbnRlZ2VyLAogICAgQ29uZmlnWWVzTm8sIENvbmZpZ1NlbGVjdGlvbiwgZ2V0Q29uZmlnTGlzdEVudHJ5CikKZnJvbSBlbmlnbWEgaW1wb3J0IGVUaW1lciwgZVBpY0xvYWQsIGlQbGF5YWJsZVNlcnZpY2UsIGdldERlc2t0b3AKZnJvbSBUb29scy5EaXJlY3RvcmllcyBpbXBvcnQgZmlsZUV4aXN0cwppbXBvcnQgdGhyZWFkaW5nCnRyeToKICAgIGltcG9ydCBxdWV1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBpbXBvcnQgUXVldWUgYXMgcXVldWUKaW1wb3J0IG9zCmltcG9ydCB0aW1lCgp0cnk6CiAgICBmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCB1cmxvcGVuLCBSZXF1ZXN0CiAgICBmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgcXVvdGUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgZnJvbSB1cmxsaWIyIGltcG9ydCB1cmxvcGVuLCBSZXF1ZXN0CiAgICBmcm9tIHVybGxpYiBpbXBvcnQgcXVvdGUKaW1wb3J0IGpzb24KCmRlZiBteV9sb2cobXNnKToKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oIi90bXAvd2F0Y2hfZGVidWcubG9nIiwgImEiKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKG1zZyArICJcbiIpCiAgICBleGNlcHQ6IHBhc3MKCgojIGVFUEdDYWNoZSBpbXBvcnRlZCBvbmNlIGF0IG1vZHVsZSBsZXZlbCAobm90IGluc2lkZSBhIGZ1bmN0aW9uIG9uIGV2ZXJ5IGNhbGwpCnRyeToKICAgIGZyb20gZW5pZ21hIGltcG9ydCBlRVBHQ2FjaGUKICAgIF9lcGdjYWNoZV9hdmFpbGFibGUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIF9lcGdjYWNoZV9hdmFpbGFibGUgPSBGYWxzZQoKIyA9PT09PT09PT09PT09PT09PT09PT0KIyBDT05GSUcKIyA9PT09PT09PT09PT09PT09PT09PT0KY29uZmlnLnBsdWdpbnMueW91cmVXYXRjaGluZyA9IENvbmZpZ1N1YnNlY3Rpb24oKQpjb25maWcucGx1Z2lucy55b3VyZVdhdGNoaW5nLmVuYWJsZWQgID0gQ29uZmlnWWVzTm8oZGVmYXVsdD1UcnVlKQpjb25maWcucGx1Z2lucy55b3VyZVdhdGNoaW5nLmR1cmF0aW9uID0gQ29uZmlnSW50ZWdlcihkZWZhdWx0PTYsIGxpbWl0cz0oMywgMzApKQpjb25maWcucGx1Z2lucy55b3VyZVdhdGNoaW5nLnBvc2l0aW9uID0gQ29uZmlnU2VsZWN0aW9uKAogICAgZGVmYXVsdD0idG9wbGVmdCIsCiAgICBjaG9pY2VzPVsKICAgICAgICAoInRvcGxlZnQiLCAgICAgIlRvcCBMZWZ0IiksCiAgICAgICAgKCJ0b3ByaWdodCIsICAgICJUb3AgUmlnaHQiKSwKICAgICAgICAoImJvdHRvbWxlZnQiLCAgIkJvdHRvbSBMZWZ0IiksCiAgICAgICAgKCJib3R0b21yaWdodCIsICJCb3R0b20gUmlnaHQiKSwKICAgIF0KKQoKUE9TVEVSX1BBVEggID0gIi90bXAveW91cmVfd2F0Y2hpbmdfcG9zdGVyLmpwZyIKVE1EQl9BUElfS0VZID0gIjkxMWQ3ZDBhZGUzNTJiYTJiZDk4YzQ1Yzk2YTI0Y2NhIgpVU0VSX0FHRU5UICAgPSAiTW96aWxsYS81LjAgKEVuaWdtYTIgWW91cmVXYXRjaGluZ1BsdWdpbi8xLjApIgoKIyA9PT09PT09PT09PT09PT09PT09PT0KIyBLSUxMIFNXSVRDSCAoUmVtb3RlIENvbnRyb2wpCiMgVG8gZGlzYWJsZSBwbHVnaW46IHVwZGF0ZSB0aGUgUGFzdGViaW4gSlNPTiB0byB7InN0YXR1cyI6ICJkaXNhYmxlZCIsICJtZXNzYWdlIjogIi4uLiJ9CiMgPT09PT09PT09PT09PT09PT09PT09Cl9QTFVHSU5fQUNUSVZFID0gVHJ1ZQpfUExVR0lOX01TRyAgICA9ICIiCgpkZWYgX2NoZWNrX2tpbGxfc3dpdGNoKCk6CiAgICBnbG9iYWwgX1BMVUdJTl9BQ1RJVkUsIF9QTFVHSU5fTVNHCiAgICB0cnk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCB1cmxvcGVuLCBSZXF1ZXN0IGFzIF9SZXEKICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAgICAgICAgIGZyb20gdXJsbGliMiBpbXBvcnQgdXJsb3BlbiwgUmVxdWVzdCBhcyBfUmVxCiAgICAgICAgcmVxID0gX1JlcSgKICAgICAgICAgICAgImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9hc2RyZXJlMTIzLWFsdC9Zb3VyZVdhdGNoaW5nL21haW4vc3RhdHVzLmpzb24iLAogICAgICAgICAgICBoZWFkZXJzPXsiVXNlci1BZ2VudCI6IFVTRVJfQUdFTlR9CiAgICAgICAgKQogICAgICAgIHIgPSB1cmxvcGVuKHJlcSwgdGltZW91dD00KQogICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKHIucmVhZCgpLmRlY29kZSgidXRmLTgiKSkKICAgICAgICBpZiBkYXRhLmdldCgic3RhdHVzIiwgImFjdGl2ZSIpICE9ICJhY3RpdmUiOgogICAgICAgICAgICBfUExVR0lOX0FDVElWRSA9IEZhbHNlCiAgICAgICAgICAgIF9QTFVHSU5fTVNHID0gZGF0YS5nZXQoIm1lc3NhZ2UiLCAiVGhpcyBwbHVnaW4gaGFzIGJlZW4gZGlzYWJsZWQgYnkgdGhlIGRldmVsb3Blci4iKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBwYXNzICAjIGlmIHNlcnZlciB1bnJlYWNoYWJsZSwga2VlcCBwbHVnaW4gcnVubmluZwoKdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9X2NoZWNrX2tpbGxfc3dpdGNoLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQoKIyA9PT09PT09PT09PT09PT09PT09PT0KIyBUSFJFQUQgLT4gTUFJTiBUSFJFQUQgQlJJREdFCiMgX3BvbGxfdGltZXIgaXMgY3JlYXRlZCBhdCBtb2R1bGUgaW1wb3J0IHRpbWUgb24gdGhlIE1BSU4gdGhyZWFkLgojIEJhY2tncm91bmQgdGhyZWFkcyBvbmx5IGNhbGwgLnN0YXJ0KCkgLSBuZXZlciBjb25zdHJ1Y3QgbmV3IHRpbWVycy4KIyA9PT09PT09PT09PT09PT09PT09PT0KX21haW5fdGhyZWFkX3F1ZXVlICA9IHF1ZXVlLlF1ZXVlKCkKX3BvbGxfdGltZXIgICAgICAgICA9IGVUaW1lcigpICAgIyBjb25zdHJ1Y3RlZCBvbiBtYWluIHRocmVhZCBhdCBpbXBvcnQgdGltZQpfcG9sbF90aW1lcl9zdGFydGVkID0gRmFsc2UKCgpkZWYgX3BvbGxfcXVldWUoKToKICAgICIiIkRyYWlucyBhbGwgcGVuZGluZyBVSSBjYWxscyBvbiB0aGUgbWFpbiBFbmlnbWEyIHRocmVhZC4iIiIKICAgIGdsb2JhbCBfcG9sbF90aW1lcl9zdGFydGVkCiAgICBfcG9sbF90aW1lcl9zdGFydGVkID0gRmFsc2UKICAgIHdoaWxlIFRydWU6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBmdW5jLCBhcmdzLCBrd2FyZ3MgPSBfbWFpbl90aHJlYWRfcXVldWUuZ2V0X25vd2FpdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZ1bmMoKmFyZ3MsICoqa3dhcmdzKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludCgiW1lvdXJlV2F0Y2hpbmddIG1haW4tdGhyZWFkIGNhbGxiYWNrIGVycm9yOiIsIGUpCiAgICAgICAgZXhjZXB0IHF1ZXVlLkVtcHR5OgogICAgICAgICAgICBicmVhawoKCl9wb2xsX3RpbWVyLmNhbGxiYWNrLmFwcGVuZChfcG9sbF9xdWV1ZSkKCgpkZWYgY2FsbEluTWFpblRocmVhZChmdW5jLCAqYXJncywgKiprd2FyZ3MpOgogICAgIiIiCiAgICBTY2hlZHVsZSBmdW5jKCphcmdzLCAqKmt3YXJncykgb24gdGhlIG1haW4gRW5pZ21hMiB0aHJlYWQgdXNpbmcgVHdpc3RlZCBBUEkuCiAgICAiIiIKICAgIGZyb20gdHdpc3RlZC5pbnRlcm5ldCBpbXBvcnQgcmVhY3RvcgogICAgcmVhY3Rvci5jYWxsRnJvbVRocmVhZChmdW5jLCAqYXJncywgKiprd2FyZ3MpCgoKIyA9PT09PT09PT09PT09PT09PT09PT0KIyBIRUxQRVI6IGdldCBhY3R1YWwgc2NyZWVuIGRpbWVuc2lvbnMgKHN1cHBvcnRzIDcyMHAgYW5kIDEwODBwKQojID09PT09PT09PT09PT09PT09PT09PQpkZWYgX2dldFNjcmVlblNpemUoKToKICAgIHRyeToKICAgICAgICBzeiA9IGdldERlc2t0b3AoMCkuc2l6ZSgpCiAgICAgICAgcmV0dXJuIHN6LndpZHRoKCksIHN6LmhlaWdodCgpCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHJldHVybiAxMjgwLCA3MjAgICAjIHNhZmUgZmFsbGJhY2sKCgojID09PT09PT09PT09PT09PT09PT09PQojIE9WRVJMQVkgU0NSRUVOCiMgPT09PT09PT09PT09PT09PT09PT09CmNsYXNzIFlvdXJlV2F0Y2hpbmdTY3JlZW4oU2NyZWVuKToKCiAgICBkZWYgX2dldEdlb21ldHJ5KHNlbGYpOgogICAgICAgIHBvcyAgICAgICAgICAgPSBjb25maWcucGx1Z2lucy55b3VyZVdhdGNoaW5nLnBvc2l0aW9uLnZhbHVlCiAgICAgICAgc3csIHNoICAgICAgICA9IF9nZXRTY3JlZW5TaXplKCkKICAgICAgICB3LCBoICAgICAgICAgID0gNDQwLCA5MAogICAgICAgIG1hcmdpbiAgICAgICAgPSA0MAogICAgICAgIGlmIHBvcyA9PSAidG9wbGVmdCI6CiAgICAgICAgICAgIHJldHVybiBtYXJnaW4sIG1hcmdpbiwgdywgaAogICAgICAgIGVsaWYgcG9zID09ICJ0b3ByaWdodCI6CiAgICAgICAgICAgIHJldHVybiBzdyAtIHcgLSBtYXJnaW4sIG1hcmdpbiwgdywgaAogICAgICAgIGVsaWYgcG9zID09ICJib3R0b21sZWZ0IjoKICAgICAgICAgICAgcmV0dXJuIG1hcmdpbiwgc2ggLSBoIC0gbWFyZ2luLCB3LCBoCiAgICAgICAgZWxzZTogICMgYm90dG9tcmlnaHQKICAgICAgICAgICAgcmV0dXJuIHN3IC0gdyAtIG1hcmdpbiwgc2ggLSBoIC0gbWFyZ2luLCB3LCBoCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNlc3Npb24sIHRpdGxlPSIiLCBwb3N0ZXJQYXRoPU5vbmUpOgogICAgICAgICMgc2tpbiBNVVNUIGJlIHNldCBiZWZvcmUgU2NyZWVuLl9faW5pdF9fCiAgICAgICAgeCwgeSwgdywgaCA9IHNlbGYuX2dldEdlb21ldHJ5KCkKCiAgICAgICAgc2VsZi5za2luID0gIiIiCiAgICAgICAgPHNjcmVlbiBuYW1lPSJZb3VyZVdhdGNoaW5nU2NyZWVuIgogICAgICAgICAgICAgICAgcG9zaXRpb249IiVkLCVkIiBzaXplPSIlZCwlZCIKICAgICAgICAgICAgICAgIGZsYWdzPSJ3Zk5vQm9yZGVyIiB6UG9zaXRpb249Ijk5Ij4KICAgICAgICAgICAgPCEtLSBTbGVlayBzZW1pLXRyYW5zcGFyZW50IGRhcmsgY29udGFpbmVyIC0tPgogICAgICAgICAgICA8d2lkZ2V0IG5hbWU9ImJhY2tncm91bmQiCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb249IjAsMCIgc2l6ZT0iJWQsJWQiCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yPSIjQkUwMDAwMDAiCiAgICAgICAgICAgICAgICAgICAgelBvc2l0aW9uPSI5MCIvPgogICAgICAgICAgICAKICAgICAgICAgICAgPCEtLSBMYW5kc2NhcGUgQmFja2Ryb3AgaW1hZ2UgKDE2OjkgQmFubmVyIHByZWNpc2VseSBzaXplZCkgLS0+CiAgICAgICAgICAgIDx3aWRnZXQgbmFtZT0icG9zdGVyIgogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uPSIxMCwxMCIgc2l6ZT0iMTI0LDcwIgogICAgICAgICAgICAgICAgICAgIHpQb3NpdGlvbj0iOTUiIGFscGhhdGVzdD0iYmxlbmQiLz4KICAgICAgICAgICAgCiAgICAgICAgICAgIDwhLS0gIllvdSdyZSB3YXRjaGluZy4uLiIgc21hbGwgdGV4dCAtLT4KICAgICAgICAgICAgPHdpZGdldCBuYW1lPSJsYWJlbF93YXRjaGluZyIKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj0iMTQ1LDIwIiBzaXplPSIyODAsMjIiCiAgICAgICAgICAgICAgICAgICAgZm9udD0iUmVndWxhcjsxNSIgZm9yZWdyb3VuZENvbG9yPSIjQUFBQUFBIgogICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50PSIxIiB2YWxpZ249InRvcCIgaGFsaWduPSJsZWZ0IgogICAgICAgICAgICAgICAgICAgIHpQb3NpdGlvbj0iOTUiIG5vV3JhcD0iMSIvPgogICAgICAgICAgICAKICAgICAgICAgICAgPCEtLSBNb3ZpZSBUaXRsZSB0ZXh0IChDaW5lbWF0aWMgc2l6aW5nKSAtLT4KICAgICAgICAgICAgPHdpZGdldCBuYW1lPSJsYWJlbF90aXRsZSIKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj0iMTQ1LDMwIiBzaXplPSIyODUsMzUiCiAgICAgICAgICAgICAgICAgICAgZm9udD0iUmVndWxhcjsyNCIgZm9yZWdyb3VuZENvbG9yPSIjRkZGRkZGIgogICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50PSIxIiB2YWxpZ249InRvcCIgaGFsaWduPSJsZWZ0IgogICAgICAgICAgICAgICAgICAgIHpQb3NpdGlvbj0iOTUiIG5vV3JhcD0iMSIvPgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICA8IS0tIFJhdGluZyBhbmQgWWVhciAoUHJlbWl1bSBpbmZvKSAtLT4KICAgICAgICAgICAgPHdpZGdldCBuYW1lPSJsYWJlbF9yYXRpbmciCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb249IjE0NSw2MCIgc2l6ZT0iMjgwLDIwIgogICAgICAgICAgICAgICAgICAgIGZvbnQ9IlJlZ3VsYXI7MTYiIGZvcmVncm91bmRDb2xvcj0iI0ZGRDcwMCIKICAgICAgICAgICAgICAgICAgICB0cmFuc3BhcmVudD0iMSIgdmFsaWduPSJ0b3AiIGhhbGlnbj0ibGVmdCIKICAgICAgICAgICAgICAgICAgICB6UG9zaXRpb249Ijk1IiBub1dyYXA9IjEiLz4KICAgICAgICA8L3NjcmVlbj4KICAgICAgICAiIiIgJSAoeCwgeSwgdywgaCwgdywgaCkKCiAgICAgICAgU2NyZWVuLl9faW5pdF9fKHNlbGYsIHNlc3Npb24pCgogICAgICAgICMgYmFja2dyb3VuZCA9IExhYmVsIHdpdGggZW1wdHkgdGV4dDsgcmVuZGVyZWQgYXMgY29sb3JlZCByZWN0YW5nbGUKICAgICAgICBzZWxmWyJiYWNrZ3JvdW5kIl0gICAgID0gTGFiZWwoIiIpCiAgICAgICAgc2VsZlsicG9zdGVyIl0gICAgICAgICA9IFBpeG1hcCgpCiAgICAgICAgc2VsZlsibGFiZWxfd2F0Y2hpbmciXSA9IExhYmVsKCJZb3UncmUgd2F0Y2hpbmcuLi4iKQogICAgICAgIHNlbGZbImxhYmVsX3RpdGxlIl0gICAgPSBMYWJlbCh0aXRsZSBvciAiIikKICAgICAgICBzZWxmWyJsYWJlbF9yYXRpbmciXSAgID0gTGFiZWwoIiIpCgogICAgICAgIHNlbGYuX3RpdGxlICAgICAgPSB0aXRsZQogICAgICAgIHNlbGYuX3Bvc3RlclBhdGggPSBwb3N0ZXJQYXRoCiAgICAgICAgc2VsZi5fY2xvc2VkICAgICA9IEZhbHNlICAgIyBndWFyZCBhZ2FpbnN0IGRvdWJsZS1jbG9zZQoKICAgICAgICBzZWxmLnBpY0xvYWQgPSBlUGljTG9hZCgpCiAgICAgICAgc2VsZi5waWNMb2FkLlBpY3R1cmVEYXRhLmdldCgpLmFwcGVuZChzZWxmLl9wYWludFBvc3RlckRvbmUpCgogICAgICAgIHNlbGYuaGlkZVRpbWVyID0gZVRpbWVyKCkKICAgICAgICBzZWxmLmhpZGVUaW1lci5jYWxsYmFjay5hcHBlbmQoc2VsZi5fZG9DbG9zZSkKCiAgICAgICAgc2VsZi5vbkxheW91dEZpbmlzaC5hcHBlbmQoc2VsZi5fb25TdGFydCkKCiAgICBkZWYgX29uU3RhcnQoc2VsZik6CiAgICAgICAgc2VsZi5fcmVzZXRUaW1lcigpCiAgICAgICAgaWYgc2VsZi5fcG9zdGVyUGF0aCBhbmQgZmlsZUV4aXN0cyhzZWxmLl9wb3N0ZXJQYXRoKToKICAgICAgICAgICAgc2VsZi5fbG9hZFBvc3RlcihzZWxmLl9wb3N0ZXJQYXRoKQoKICAgIGRlZiBfcmVzZXRUaW1lcihzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuaGlkZVRpbWVyLnN0b3AoKQogICAgICAgICAgICBkdXJhdGlvbiA9IGNvbmZpZy5wbHVnaW5zLnlvdXJlV2F0Y2hpbmcuZHVyYXRpb24udmFsdWUgKiAxMDAwCiAgICAgICAgICAgIHNlbGYuaGlkZVRpbWVyLnN0YXJ0KGR1cmF0aW9uLCBUcnVlKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoIltZb3VyZVdhdGNoaW5nXSBfcmVzZXRUaW1lciBlcnJvcjoiLCBlKQoKICAgIGRlZiBfbG9hZFBvc3RlcihzZWxmLCBwYXRoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGluc3RhbmNlID0gc2VsZlsicG9zdGVyIl0uaW5zdGFuY2UKICAgICAgICAgICAgIyBHdWFyZDogaW5zdGFuY2UgY2FuIGJlIE5vbmUgaWYgd2lkZ2V0IG5vdCB5ZXQgZnVsbHkgaW5pdGlhbGl6ZWQKICAgICAgICAgICAgaWYgaW5zdGFuY2UgaXMgTm9uZToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBzYyA9IGluc3RhbmNlLnNpemUoKQogICAgICAgICAgICAjIFt3aWR0aCwgaGVpZ2h0LCBhc3BlY3QoMT1rZWVwIHJhdGlvKSwgY2FjaGUoMD1vZmYpLAogICAgICAgICAgICAjICBkZXNhdHVyYXRlKDA9b2ZmKSwgcm90YXRlKDA9b2ZmKSwgYmdfY29sb3JdCiAgICAgICAgICAgIHNlbGYucGljTG9hZC5zZXRQYXJhKFtzYy53aWR0aCgpLCBzYy5oZWlnaHQoKSwgMSwgMCwgMCwgMCwgIiMwMDAwMDAwMCJdKQogICAgICAgICAgICBzZWxmLnBpY0xvYWQuc3RhcnREZWNvZGUocGF0aCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KCJbWW91cmVXYXRjaGluZ10gX2xvYWRQb3N0ZXIgZXJyb3I6IiwgZSkKCiAgICBkZWYgX3BhaW50UG9zdGVyRG9uZShzZWxmLCBwaWNJbmZvPU5vbmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5fY2xvc2VkOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHB0ciA9IHNlbGYucGljTG9hZC5nZXREYXRhKCkKICAgICAgICAgICAgaWYgcHRyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgc2VsZlsicG9zdGVyIl0uaW5zdGFuY2Uuc2V0UGl4bWFwKHB0cikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KCJbWW91cmVXYXRjaGluZ10gX3BhaW50UG9zdGVyRG9uZSBlcnJvcjoiLCBlKQoKICAgIGRlZiBfZG9DbG9zZShzZWxmKToKICAgICAgICBpZiBzZWxmLl9jbG9zZWQ6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHNlbGYuX2Nsb3NlZCA9IFRydWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuaGlkZVRpbWVyLnN0b3AoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHBhc3MKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuaGlkZSgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwoKICAgIGRlZiBmb3JjZUNsb3NlKHNlbGYpOgogICAgICAgICIiIkNhbGxlZCBleHRlcm5hbGx5IChuZXh0IHphcCBvciBwbHVnaW4gc2h1dGRvd24pLiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5oaWRlVGltZXIuc3RvcCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwogICAgICAgIHNlbGYuX2RvQ2xvc2UoKQoKCiMgPT09PT09PT09PT09PT09PT09PT09CiMgTUFJTiBQTFVHSU4gQ0xBU1MKIyA9PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgWW91cmVXYXRjaGluZ1BsdWdpbjoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgc2Vzc2lvbik6CiAgICAgICAgbXlfbG9nKCdbSU5JVF0gWW91cmVXYXRjaGluZyBQbHVnaW4gc3RhcnRlZCcpCiAgICAgICAgc2VsZi5zZXNzaW9uICAgICAgID0gc2Vzc2lvbgogICAgICAgIHNlbGYuY3VycmVudFNjcmVlbiA9IE5vbmUKICAgICAgICBzZWxmLl9sYXRlc3RUaXRsZSAgPSBOb25lCgogICAgICAgIHNlbGYuc2Vzc2lvbi5uYXYuZXZlbnQuYXBwZW5kKHNlbGYuX29uTmF2RXZlbnQpCgogICAgZGVmIF9vbk5hdkV2ZW50KHNlbGYsIGV2ZW50KToKICAgICAgICBteV9sb2coJ1tFVkVOVF0gTmF2RXZlbnQgdHJpZ2dlcmVkOiB7fScuZm9ybWF0KGV2ZW50KSkKICAgICAgICBpZiBub3QgX1BMVUdJTl9BQ1RJVkU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIG5vdCBjb25maWcucGx1Z2lucy55b3VyZVdhdGNoaW5nLmVuYWJsZWQudmFsdWU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGV2ZW50ID09IGlQbGF5YWJsZVNlcnZpY2UuZXZTdGFydDoKICAgICAgICAgICAgc2VsZi5fb25TZXJ2aWNlQ2hhbmdlZCgpCgogICAgZGVmIF9vblNlcnZpY2VDaGFuZ2VkKHNlbGYpOgogICAgICAgIG15X2xvZygnW1NWQ10gU2VydmljZSBDaGFuZ2VkIGNhbGxlZCcpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZXJ2aWNlID0gc2VsZi5zZXNzaW9uLm5hdi5nZXRDdXJyZW50U2VydmljZSgpCiAgICAgICAgICAgIGlmIG5vdCBzZXJ2aWNlOgogICAgICAgICAgICAgICAgbXlfbG9nKCdbU1ZDXSBObyBzZXJ2aWNlIGZvdW5kJykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBpbmZvID0gc2VydmljZS5pbmZvKCkKICAgICAgICAgICAgaWYgbm90IGluZm86CiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAgIHRpdGxlID0gIiIKCiAgICAgICAgICAgICMgUHJpb3JpdHkgMTogRVBHIGN1cnJlbnQgZXZlbnQgdmlhIGlTZXJ2aWNlSW5mb3JtYXRpb24uZ2V0RXZlbnQoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBldnQgPSBpbmZvLmdldEV2ZW50KDApCiAgICAgICAgICAgICAgICBpZiBldnQ6CiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSBldnQuZ2V0RXZlbnROYW1lKCkgb3IgIiIKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICMgUHJpb3JpdHkgMjogZUVQR0NhY2hlIGRpcmVjdCBsb29rdXAKICAgICAgICAgICAgaWYgbm90IHRpdGxlLnN0cmlwKCkgYW5kIF9lcGdjYWNoZV9hdmFpbGFibGU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZXBnY2FjaGUgPSBlRVBHQ2FjaGUuZ2V0SW5zdGFuY2UoKQogICAgICAgICAgICAgICAgICAgIHJlZiA9IHNlbGYuc2Vzc2lvbi5uYXYuZ2V0Q3VycmVudGx5UGxheWluZ1NlcnZpY2VSZWZlcmVuY2UoKQogICAgICAgICAgICAgICAgICAgIGlmIHJlZjoKICAgICAgICAgICAgICAgICAgICAgICAgZXZ0ID0gZXBnY2FjaGUubG9va3VwRXZlbnRUaW1lKHJlZiwgaW50KHRpbWUudGltZSgpKSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXZ0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU = </html>
